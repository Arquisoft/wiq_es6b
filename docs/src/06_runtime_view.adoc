ifndef::imagesdir[:imagesdir: ../images]

[[section-runtime-view]]
== Vista en Tiempo de Ejecución

=== Registro en la aplicación

[plantuml,"Registro",png]
----
actor User
participant App
participant Gateway
participant UserService
database DBuser

User -> App: Selecciona opción de registro
User <-- App: Muestra pantalla de registro
User -> App: Ingresa datos de registro
App -> Gateway: Envía los datos
Gateway -> UserService: Envía los datos
UserService -> UserService: Comprueba los datos

alt usuario válido

    UserService -> DBuser: Guarda datos de registro
    UserService <-- DBuser: Confirma registro
    Gateway <-- UserService : Confirma registro
    App<-- Gateway: Confirma registro
    User <-- App: Confirma Registro

else usuario no valido

    Gateway <-- UserService: Deniega registro
    App <-- Gateway: Deniega registro
    User <-- App: Deniega registro

end
----

=== Inicio de sesión en la aplicación 

[plantuml,"Login",png]
----
actor User
participant App
database DB

User -> App: Ingresa credenciales de inicio de sesión
App -> DB: Verifica cerdenciales
App <-- DB: Válida las credenciales
alt credenciales válidas
    User <-- App:  Confirma inicio de sesión
    alt usuario que nunca habia iniciado sesion
        App -> DB: Crea ranking para el usuario
    App -> DB: Pide datos de los records de todos los usuarios
    App <-- DB: Devuelve datos de los records de todos los usuarios
    App -> DB: Actualiza los rankings de todos los usuarios
else credenciales inválidas
    User <-- App:  Deniega inicio de sesión
----

=== Generacion de preguntas

[plantuml,"Generacion",png]
----
participant WApi
database DB

loop cada 2 segundos
    WApi -> DB: Genera una pregunta y la guarda
    alt mas de 500 preguntas generadas
        WApi -> DB: Borra la pregunta que más tiempo lleva guardada
----

=== Respuesta a una pregunta

[plantuml,"Respuesta",png]
----
actor User
participant App
participant WApi
database DB

User -> App: Pide una pregunta
App -> DB: Pide una pregunta
App <-- DB: Devuelve una pregunta generada
User <-- App: Muestra pregunta con opciones
alt tiempo no finalizado
    User -> App: Selecciona opción de respuesta
    App -> DB: Verifica respuesta seleccionada
    App <-- DB: Confirma la respuesta
    App -> DB: Guarda o actualiza la pregunta con su respuesta correcta
    alt respuesta correcta
        alt ultima pregunta
            User <-- App: Muestra mensaje de respuesta correcta y finaliza el juego
            App -> DB: Guarda los datos de la partida
            User <-- App: Muestra los datos de la partida
        else no ultima pregunta
            User <-- App: Muestra mensaje de respuesta correcta y continua el juego
    else respuesta incorrecta
        alt ultima pregunta
            User <-- App: Muestra mensaje de respuesta correcta y finaliza el juego
            App -> DB: Guarda los datos de la partida
            User <-- App: Muestra los datos de la partida
        else no ultima pregunta
            User <-- App: Muestra mensaje de respuesta correcta y continua el juego
else tiempo finalizado
    User <-- App: Finaliza el juego
    App -> DB: Guarda los datos de la partida
    User <-- App: Muestra los datos de la partida
----

=== Consulta del historial de usuarios

[plantuml,"Usuarios",png]
----
actor User
participant App
database DB

User -> App: Selecciona opción de ver el historial de usuarios
App -> DB: Consulta el historial de usuarios
App <-- DB: Devuelve el historial de usuarios
User <-- App: Muestra el historial de usuarios
----

=== Consulta del historial de preguntas generadas

[plantuml,"Preguntas",png]
----
actor User
participant App
database DB

User -> App: Selecciona opción de ver el historial de preguntas generadas
App -> DB: Consulta el historial de preguntas generadas
App <-- DB: Devuelve el historial de preguntas generadas
User <-- App: Muestra el historial de preguntas generadas
----

=== Consulta del historial de jugadas

[plantuml,"Jugadas",png]
----
actor User
participant App
database DB

User -> App: Selecciona opción de ver el historial de jugadas
App -> DB: Consulta el historial de jugadas
App <-- DB: Devuelve el historial de jugadas
User <-- App: Muestra el historial de jugadas
----

=== Consulta del ranking

[plantuml,"Ranking",png]
----
actor User
participant App
database DB

User -> App: Selecciona opción de ver el ranking
App -> DB: Consulta el ranking
App <-- DB: Devuelve el ranking
User <-- App: Muestra el ranking
----

=== Cambio de ajustes de partida

[plantuml,"Ajustes",png]
----
actor User
participant App
database DB

User -> App: Selecciona opción de ajustes de partida
App -> User: Muestra ajustes de partida actuales
User -> App: Cambia ajustes de partida actuales
----